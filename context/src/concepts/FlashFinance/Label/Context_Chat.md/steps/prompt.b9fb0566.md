---
timestamp: 'Fri Oct 17 2025 18:18:28 GMT-0400 (Eastern Daylight Time)'
parent: '[[..\20251017_181828.690e48ed.md]]'
content_id: b9fb0566ed37a3ff8c7e78208d7f470a09361bd3b4e8a5294d03ac89cdf10092
---

# prompt:  Implement a Deno test that verifies the Duplicate Apply error scenario for the Label concept. Consult the Label spec to understand the required “no existing label for tx\_id” precondition under the apply action. Consult the Label implementation (label.ts) to use the correct method calls (apply, getLabel, getCategoryHistory, etc.). Look at the existing operational principle test (test-op-simple.ts) for structure, imports, and assertion style, following its pattern closely by using assertEquals, assertExists, and clear console logs. You may also reference label-clear.ts (if present) for setup conventions or data formatting. Create a test named “Variant: Duplicate apply should throw an error.” In this scenario, first call apply(user, tx\_id, tx\_name, tx\_merchant, catA) once, which should succeed normally. Then call apply(user, tx\_id, tx\_name, tx\_merchant, catA) again, which should throw an error due to an existing label. After catching the exception, verify that the label still exists once in the database (no duplicate inserted) and that the category history for catA still contains exactly one entry (the original transaction). Print clear console logs, as in the operational test, to indicate each step and expected behavior. If the Label implementation does not currently throw, do not modify it; simply note the expected behavior in a short comment outside the test. The test should fail if the apply method silently overwrites instead of throwing, and the output should clearly indicate that the duplication attempt was caught or expected to error. Keep imports, DB setup, and cleanup consistent with test-op-simple.ts, and maintain the same readable assertion-based style and helpful console output for graders.
